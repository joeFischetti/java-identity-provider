<?xml version="1.0" encoding="UTF-8"?>

<afp:AttributeFilterPolicyGroup id="PolicyExample1" 
                                xmlns:afp="urn:mace:shibboleth:2.0:afp"
                                xmlns:basic="urn:mace:shibboleth:2.0:afp:mf:basic"
                                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                                xsi:schemaLocation="urn:mace:shibboleth:2.0:afp ../../../../../../../../../resources/classpath/schema/shibboleth-2.0-afp.xsd
                                                    urn:mace:shibboleth:2.0:afp:mf:basic ../../../../../../../../../resources/classpath/schema/shibboleth-2.0-afp-mf-basic.xsd ">

    <!--
        Release attributes if the person is not an alumni or a student with FERPA suppression.
    -->
    <afp:PermitValue id="studentWithSuppression" xsi:type="basic:OR">
        <afp:PermitValue xsi:type="basic:AttributeValueString" attributeID="affilition" value="student"
            negateResult="true" />
        <afp:PermitValue xsi:type="basic:AttributeValueString" attributeID="affilition" value="alum"
            negateResult="true" />
        <afp:PermitValue xsi:type="basic:AND">
            <afp:PermitValue xsi:type="basic:AttributeValueString" attributeID="affilition" value="student" />
            <afp:PermitValue xsi:type="basic:AttributeValueString" attributeID="ferpa" value="false" />
        </afp:PermitValue>
    </afp:PermitValue>

    <!-- Release some attributes to JSTOR -->
    <afp:AttributeFilterPolicy>
        <!-- This policy is in effect if the requester entity ID is JSTORs -->
        <afp:PolicyRequirement xsi:type="basic:AttributeRequesterString" value="https://www.jstor.org/shibboleth" />

        <!-- Release a transient ID -->
        <afp:AttributeRule attributeID="transientID">
            <afp:PermitValue xsi:type="basic:ANY" />
        </afp:AttributeRule>

        <!-- Release user's first name if not an alum or a student with FERPA suppresion  -->
        <afp:AttributeRule attributeID="firstName">
            <afp:PermitValue ref="studentWithSuppression" />
        </afp:AttributeRule>

        <!-- Release email address if not an alum or a student with FERPA suppresion  -->
        <afp:AttributeRule attributeID="email">
            <afp:PermitValue ref="studentWithSuppression" />
        </afp:AttributeRule>

        <!-- Release primary affiliation and verify that there is only one value -->
        <afp:AttributeRule attributeID="eduPersonPrimaryAffiliation">
            <afp:PermitValue xsi:type="basic:AND">
                <afp:PermitValue ref="eduPersonAffiliationValues" />
                <afp:PermitValue xsi:type="basic:NumberOfAttributeValues" maximum="1" />
            </afp:PermitValue>
        </afp:AttributeRule>

    </afp:AttributeFilterPolicy>

    <!-- Release some attributes to JSTOR -->
    <afp:AttributeFilterPolicy>
        <!-- This policy is in effect if the requester entity ID is ScienceDirect -->
        <afp:PolicyRequirement xsi:type="basic:AttributeRequesterString" value="https://sdauth.sciencedirect.com/" />

        <!-- Release a persistent ID -->
        <afp:AttributeRule attributeID="persistentID">
            <afp:PermitValue xsi:type="basic:ANY" />
        </afp:AttributeRule>

        <!-- Release user's first name if not an alum or a student with FERPA suppresion  -->
        <afp:AttributeRule attributeID="firstName">
            <afp:PermitValue ref="studentWithSuppression" />
        </afp:AttributeRule>

        <!-- Release email address if not an alum or a student with FERPA suppresion  -->
        <afp:AttributeRule attributeID="email">
            <afp:PermitValue ref="studentWithSuppression" />
        </afp:AttributeRule>

        <!-- Release primary affiliation and verify that there is only one value -->
        <afp:AttributeRule attributeID="eduPersonPrimaryAffiliation">
            <afp:PermitValue xsi:type="basic:AND">
                <afp:PermitValue id="eduPersonAffiliationValues" xsi:type="basic:OR">
                    <afp:PermitValue xsi:type="basic:AttributeValueString" value="faculty" />
                    <afp:PermitValue xsi:type="basic:AttributeValueString" value="student" />
                    <afp:PermitValue xsi:type="basic:AttributeValueString" value="staff" />
                    <afp:PermitValue xsi:type="basic:AttributeValueString" value="alum" />
                    <afp:PermitValue xsi:type="basic:AttributeValueString" value="member" />
                    <afp:PermitValue xsi:type="basic:AttributeValueString" value="affiliate" />
                    <afp:PermitValue xsi:type="basic:AttributeValueString" value="employee" />
                </afp:PermitValue>
                <afp:PermitValue xsi:type="basic:NumberOfAttributeValues" maximum="1" />
            </afp:PermitValue>
        </afp:AttributeRule>

        <!-- Release affiliation -->
        <afp:AttributeRule attributeID="eduPersonPrimaryAffiliation">
            <afp:PermitValue id="eduPersonAffiliationValues" xsi:type="basic:OR">
                <afp:PermitValue xsi:type="basic:AttributeValueString" value="faculty" />
                <afp:PermitValue xsi:type="basic:AttributeValueString" value="student" />
                <afp:PermitValue xsi:type="basic:AttributeValueString" value="staff" />
                <afp:PermitValue xsi:type="basic:AttributeValueString" value="alum" />
                <afp:PermitValue xsi:type="basic:AttributeValueString" value="member" />
                <afp:PermitValue xsi:type="basic:AttributeValueString" value="affiliate" />
                <afp:PermitValue xsi:type="basic:AttributeValueString" value="employee" />
            </afp:PermitValue>
        </afp:AttributeRule>

    </afp:AttributeFilterPolicy>

</afp:AttributeFilterPolicyGroup>