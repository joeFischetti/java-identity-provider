<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow.xsd"
      abstract="true">

    <!-- Rudimentary impediment to direct execution of subflow. -->
    <input name="calledAsSubflow" type="boolean" required="true" />

    <action-state id="ValidateUsernamePassword">
        
        <!-- Call outs for exceptional conditions. -->
        <transition on="AccountWarning" to="CallExpiringPassword" />
        <transition on="ExpiringPassword" to="CallExpiringPassword" />
        <transition on="ExpiredPassword" to="CallExpiredPassword" />
        <transition on="AccountLocked" to="CallAccountLocked" />
        
        <transition on="InvalidPassword" to="CallExpiredPassword" />
        
        <transition to="DisplayUsernamePasswordPage" />
    </action-state>

    <subflow-state id="CallExpiringPassword" subflow="Authentication.ExpiringPassword">
        <input name="calledAsSubflow" value="true" />
        <transition on="proceed" to="proceed" />
    </subflow-state>

    <subflow-state id="CallExpiredPassword" subflow="Authentication.ExpiredPassword">
        <input name="calledAsSubflow" value="true" />
        <transition on="proceed" to="DisplayUsernamePasswordPage" />
    </subflow-state>

    <subflow-state id="CallAccountLocked" subflow="Authentication.AccountLocked">
        <input name="calledAsSubflow" value="true" />
        <transition on="proceed" to="DisplayUsernamePasswordPage" />
    </subflow-state>

</flow>
