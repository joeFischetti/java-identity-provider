<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:context="http://www.springframework.org/schema/context"
    xmlns:util="http://www.springframework.org/schema/util" xmlns:p="http://www.springframework.org/schema/p" xmlns:c="http://www.springframework.org/schema/c"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"

    default-init-method="initialize" default-destroy-method="destroy">

    <bean id="searchDnResolver" class="org.ldaptive.auth.PooledSearchDnResolver" p:baseDn-ref="shibboleth.authn.LDAP.baseDn"
        p:subtreeSearch-ref="shibboleth.authn.LDAP.subtreeSearch" p:userFilter-ref="shibboleth.authn.LDAP.userFilter"
        p:connectionFactory-ref="searchPooledConnectionFactory" lazy-init="true" />

    <bean id="authHandler" class="org.ldaptive.auth.PooledBindAuthenticationHandler" p:connectionFactory-ref="bindPooledConnectionFactory" />

    <bean id="searchPooledConnectionFactory" class="org.ldaptive.pool.PooledConnectionFactory"
        p:connectionPool-ref="searchConnectionPool" lazy-init="true" />

    <bean id="bindPooledConnectionFactory" class="org.ldaptive.pool.PooledConnectionFactory" p:connectionPool-ref="bindConnectionPool" />

    <bean id="searchConnectionPool" class="org.ldaptive.pool.BlockingConnectionPool" parent="connectionPool"
        p:connectionFactory-ref="searchConnectionFactory" lazy-init="true" />

    <bean id="bindConnectionPool" class="org.ldaptive.pool.BlockingConnectionPool" parent="connectionPool"
        p:connectionFactory-ref="bindConnectionFactory" />

    <bean id="connectionPool" class="org.ldaptive.pool.BlockingConnectionPool" abstract="true" init-method="initialize"
        p:blockWaitTime-ref="shibboleth.authn.LDAP.pool.blockWaitTime" p:poolConfig-ref="poolConfig"
        p:pruneStrategy-ref="pruneStrategy" p:validator-ref="searchValidator" />

    <bean id="poolConfig" class="org.ldaptive.pool.PoolConfig" p:minPoolSize-ref="shibboleth.authn.LDAP.pool.minSize"
        p:maxPoolSize-ref="shibboleth.authn.LDAP.pool.maxSize" p:validateOnCheckOut-ref="shibboleth.authn.LDAP.pool.validateOnCheckout"
        p:validatePeriodically-ref="shibboleth.authn.LDAP.pool.validatePeriodically" p:validatePeriod-ref="shibboleth.authn.LDAP.pool.validatePeriod" />

    <bean id="searchConnectionFactory" class="org.ldaptive.DefaultConnectionFactory" p:connectionConfig-ref="searchConnectionConfig"
        lazy-init="true" />

    <bean id="bindConnectionFactory" class="org.ldaptive.DefaultConnectionFactory" p:connectionConfig-ref="bindConnectionConfig" />

    <bean id="connectionConfig" class="org.ldaptive.ConnectionConfig" abstract="true" p:ldapUrl-ref="shibboleth.authn.LDAP.ldapUrl"
        p:useStartTLS-ref="shibboleth.authn.LDAP.useStartTLS" p:useSSL-ref="shibboleth.authn.LDAP.useSSL"
        p:connectTimeout-ref="shibboleth.authn.LDAP.connectTimeout" />

    <bean id="pruneStrategy" class="org.ldaptive.pool.IdlePruneStrategy" p:prunePeriod-ref="shibboleth.authn.LDAP.pool.prunePeriod"
        p:idleTime-ref="shibboleth.authn.LDAP.pool.idleTime" />

    <bean id="searchValidator" class="org.ldaptive.pool.SearchValidator" />

</beans>
