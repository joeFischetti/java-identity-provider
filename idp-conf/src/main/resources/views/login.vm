##
## Velocity Template for DisplayUsernamePasswordPage view-state
##
## Velocity context will contain the following properties
## flowExecutionUrl - the form action location
## flowRequestContext - the Spring Web Flow RequestContext
## rpUIContext - the context with SP UI information from the metadata
## flowExecutionKey - the SWF execution key (this is built into the flowExecutionUrl)
## encoder - HTMLEncoder class
## request - HttpServletRequest
## response - HttpServletResponse

#set ( $username = $authenticationContext.getSubcontext('net.shibboleth.idp.authn.context.UsernamePasswordContext', true).getUsername() )
#set ( $rpContext = $profileRequestContext.getSubcontext('net.shibboleth.idp.profile.context.RelyingPartyContext') )
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  	<head>
    	<meta charset="utf-8" />
    	<title>Example Login Page</title>
    	<link rel="stylesheet" type="text/css" href="$request.getContextPath()/css/main.css"/>
  	</head>

  	<body>
    <div class="wrapper">
      <div class="container">
        <header>
          <a class="logo" href="../images/dummylogo.png"><img src="$request.getContextPath()/images/dummylogo.png" alt="Replace or remove this logo"/></a>
        </header>

        <div class="content">
          <div class="column one">
            <form action="$flowExecutionUrl" method="post">
              #if ( $authenticationErrorContext && $authenticationErrorContext.getClassifiedErrors().size() > 0 )
                <p class="form-element form-error">
                ERROR: $encoder.encodeForHTML($authenticationErrorContext.getClassifiedErrors().toString())
                </p>
              #elseif ( $authenticationErrorContext && $authenticationErrorContext.getExceptions().size() > 0 )
                <p class="form-element form-error">
                #if ( $authenticationErrorContext.getExceptions().get(0).getMessage() )
                    ERROR: $encoder.encodeForHTML($authenticationErrorContext.getExceptions().get(0).getMessage())
                #else
                    ERROR: $encoder.encodeForHTML($authenticationErrorContext.getExceptions().get(0).getClass().getName())
                #end
                </p>
              #end

              #if ( !$rpContext.getRelyingPartyId().contains($rpUIContext.getServiceName()) )
                <legend>
                  Login to $encoder.encodeForHTML($rpUIContext.getServiceName())
                </legend>
              #end

              <section>
                <label for="j_username">Username</label>
                <input class="form-element form-field" name="j_username" type="text"
                	value="#if($username)$encoder.encodeForHTML($username)#end">
              </section>

              <section>
                <label for="j_password">Password</label>
                <input class="form-element form-field" name="j_password" type="password" value="">
              </section>

              <section>
                <input type="checkbox" name="donotcache" value="1" /> Don't Remember Login
              </section>
              
              ## TODO change param name for consent revocation
              ## <section>
              ##  <input id="uApprove.consent-revocation" type="checkbox" name="uApprove.consent-revocation" value="true"/>
              ##  Clear data release consent for this service
              ## </section>
              
              <section>
                <button class="form-element form-button" type="submit" name="_eventId_proceed" >Login</button>
              </section>
            </form>

			<!-- 
              //
              //    SP Description & Logo (optional)
              //    These idpui lines will display added information (if available
              //    in the metadata) about the Service Provider (SP) that requested
              //    authentication. These idpui lines are "active" in this example
              //    (not commented out) -- this extra SP info will be displayed.
              //    Remove or comment out these lines to stop the display of the
              //    added SP information.
              //
              //    Documentation: 
              //      https://wiki.shibboleth.net/confluence/display/SHIB2/IdPAuthUserPassLoginPage  TODO
              //
              //    Example:
            -->
            #set ($logo = $rpUIContext.getLogo())
            #if ($logo)
              <img src= "$encoder.encodeForHTMLAttribute($logo)"
                  alt="logo for $encoder.encodeForHTMLAttribute($rpUIContext.getServiceName())"/>
            #end
            #set ($desc = $rpUIContext.getServiceDescription())
            #if ($desc)
              $encoder.encodeForHTML($desc)
            #end
            
          </div>
          <div class="column two">
            <ul class="list list-help">
              <li class="list-help-item"><a href="#"><span class="item-marker">&rsaquo;</span> Forgot your password?</a></li>
              <li class="list-help-item"><a href="#"><span class="item-marker">&rsaquo;</span> Need Help?</a></li>
              <li class="list-help-item"><a href="https://wiki.shibboleth.net/confluence/display/SHIB2/IdPAuthUserPassLoginPage"><span class="item-marker">&rsaquo;</span> How to Customize this Skin</a></li>
            </ul>
          </div>
        </div>
      </div>

      <footer>
        <div class="container container-footer">
          <p class="footer-text">Insert your footer text here.</p>
        </div>
      </footer>
    </div>
    
 	</body>
</html>