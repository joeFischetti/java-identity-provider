<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:c="http://www.springframework.org/schema/c" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"

	default-init-method="initialize" default-destroy-method="destroy">
    
    <!--
    The actual beans used are in user-space, but they inherit from the maps below. We have to use a
    MapFactoryBean instead of util:map because merging isn't supported by the util:map schema.
    -->
    <import resource="../../conf/audit.xml"/>

    <bean id="shibboleth.DefaultPostDecodeAuditExtractors"
            class="org.springframework.beans.factory.config.MapFactoryBean" abstract="true">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.PROTOCOL"/>
                    </key>
                    <bean class="net.shibboleth.idp.profile.audit.impl.ConstantAuditExtractor">
                        <constructor-arg>
                            <list>
                                <ref bean="shibboleth.MetadataLookup.Protocol" />
                            </list>
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.REQUEST_BINDING"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SAMLBindingAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookup.SAMLBindingContext"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.REQUEST_ID"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SAMLMessageIDAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookupOrCreate.SAMLMessageInfoContext"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.REQUEST_ISSUE_INSTANT"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SAMLMessageInstantAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookupOrCreate.SAMLMessageInfoContext"
                                c:f-ref="shibboleth.MessageContextLookup.Inbound" />
                        </constructor-arg>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>
        
    <bean id="shibboleth.DefaultPostLookupAuditExtractors"
            class="org.springframework.beans.factory.config.MapFactoryBean" abstract="true">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.SERVICE_PROVIDER"/>
                    </key>
                    <bean class="net.shibboleth.idp.profile.audit.impl.ContextDataAuditExtractor"
                        c:fn-ref="shibboleth.RelyingPartyIdLookup.Simple" />
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.IDENTITY_PROVIDER"/>
                    </key>
                    <bean class="net.shibboleth.idp.profile.audit.impl.ContextDataAuditExtractor"
                        c:fn-ref="shibboleth.ResponderIdLookup.Simple" />
                </entry>
            </map>
        </property>
    </bean>
    
    <bean id="shibboleth.DefaultPostResponseAuditExtractors"
            class="org.springframework.beans.factory.config.MapFactoryBean" abstract="true">
        <property name="sourceMap">
            <map>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.RESPONSE_BINDING"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SAMLBindingAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookup.SAMLBindingContext"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.RESPONSE_ID"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SAMLMessageIDAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookupOrCreate.SAMLMessageInfoContext"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.RESPONSE_ISSUE_INSTANT"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SAMLMessageInstantAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.ChildLookupOrCreate.SAMLMessageInfoContext"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.IN_RESPONSE_TO"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.InResponseToAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.STATUS_CODE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.StatusCodeAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.SUBSTATUS_CODE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.SubStatusCodeAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <util:constant static-field="net.shibboleth.idp.saml.profile.SAMLAuditFields.STATUS_MESSAGE"/>
                    </key>
                    <bean class="net.shibboleth.idp.saml.audit.impl.StatusMessageAuditExtractor">
                        <constructor-arg>
                            <bean class="com.google.common.base.Functions" factory-method="compose"
                                c:g-ref="shibboleth.MessageLookup.SAMLObject"
                                c:f-ref="shibboleth.MessageContextLookup.Outbound" />
                        </constructor-arg>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>
    
</beans>
