<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow.xsd"
      parent="SubjectC14N.Abstract">

    <!--
    This is a one-step subflow that uses the subflow ID to derive a bean name to invoke, the bean being
    an action that performs SAML subject canonicalization of some type. This is used to run the built-in
    canonicalization capabilities pre-defined in the software.
    -->
    
    <action-state id="DoCanonicalization">
        <evaluate expression="flowExecutionContext.getActiveSession().getDefinition().getApplicationContext().getBean('Shibboleth.C14N.' + flowExecutionContext.getActiveSession().getDefinition().getId().split('/')[1]).execute(flowRequestContext)" />
    </action-state>

    <bean-import resource="subject-c14n-saml-default-beans.xml" />

</flow>
