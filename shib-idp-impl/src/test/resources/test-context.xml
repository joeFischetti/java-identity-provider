<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/util
           http://www.springframework.org/schema/util/spring-util.xsd">

    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <!-- Datasource definition -->
    <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
        <property name="driverClassName" value="org.hsqldb.jdbcDriver" />
        <!-- 
        <property name="url" value="jdbc:hsqldb:hsql://localhost/user-consent-test" />
        -->
        <property name="url" value="jdbc:hsqldb:mem:user-consent-test" />    
        <property name="username" value="SA" />
        <property name="password" value="" />
    </bean>
    
    <bean id="jdbcStorage" class="edu.internet2.middleware.shibboleth.idp.consent.persistence.JDBCStorage">
       <property name="dataSource" ref="dataSource" /> 
    </bean>
    
    <bean id="mapStorage" class="edu.internet2.middleware.shibboleth.idp.consent.persistence.MapStorage" init-method="initialize"/>
    
    <bean id="cache" class="java.util.concurrent.ConcurrentHashMap"/>
    
    <bean id="userConsentContextBuilder" class="edu.internet2.middleware.shibboleth.idp.consent.components.UserConsentContextBuilder">
       <!--
       <property name="storage" ref="storage" />
       -->
       <property name="uniqueIdAttribute" value="uniqueID" /> 
    </bean>
    
    <bean id="descriptionBuilder" class="edu.internet2.middleware.shibboleth.idp.consent.components.DescriptionBuilder">
        <constructor-arg type="java.util.Locale">
            <util:constant static-field="java.util.Locale.ENGLISH"/>
        </constructor-arg>
        <constructor-arg type="boolean" value="true"/>
    </bean>
  
    <bean id="relyingPartyBlacklist" class="edu.internet2.middleware.shibboleth.idp.consent.components.RelyingPartyBlacklist">
         <property name="blacklist">
            <set>
                <value>https://sp\.example1\.org/shibboleth</value>
                <value>https://sp\.example2\.org/shibboleth</value>
                <value>https://.*\.example3\.org/shibboleth</value>                
            </set>
          </property>
    </bean>
    
    <bean id="termsOfUse" class="edu.internet2.middleware.shibboleth.idp.consent.components.TermsOfUse">
      <constructor-arg type="java.lang.String" value="1.0"/>
      <constructor-arg type="org.springframework.core.io.Resource"
                       value="/edu/internet2/middleware/shibboleth/idp/consent/terms-of-use-example.txt"/>
    </bean>
    
    <bean id="attributeList" class="edu.internet2.middleware.shibboleth.idp.consent.components.AttributeList">
         <property name="orderedAttributeIds">
            <list>
                <value>attribute_1</value>
                <value>attribute_3</value>
                <value>attribute_4</value>
                <value>attribute_7</value>   
                <value>attribute_9</value>           
            </list>
          </property>
         <property name="blacklistedAttributeIds">
            <set>
                <value>attribute_2</value>
                <value>attribute_5</value>               
            </set>
          </property>
    </bean>
    
    
    <!-- Web stuff  -->
    <!--
    <bean id="velocityConfig" class="org.springframework.web.servlet.view.velocity.VelocityConfigurer">
        <property name="resourceLoaderPath">
            <value>/</value>
        </property>
    </bean>
    
    <bean id="viewResolver" class="org.springframework.web.servlet.view.velocity.VelocityViewResolver">
        <property name="prefix"><value>/WEB-INF/views/</value></property>
        <property name="suffix"><value>.vm</value></property>
        <property name="exposeSpringMacroHelpers"><value>true</value></property>
    </bean>
    -->
    
    <!-- Internationalization -->
    <bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
        <property name="basenames">
              <list>
                    <value>terms-of-use</value>
                    <value>attribute-release</value>
              </list>
        </property>
    </bean>
    
</beans>